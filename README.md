# Сервис для предсказания цены автомобиля

Данный репозиторий включается в себя [ноутбук](./notebooks/HW1_Regression_with_inference.ipynb) с:
* аналитикой имеющихся данных;
* экспериментами по обучению моделей;
* сохранением лучшей модели (включая веса и весь пайплайн предобработки в `pickle` файл).

Возможно, ноутбук удобней смотреть в [NBViewer](https://nbviewer.org/github/slavkostrov/car_price_prediction_service/blob/master/notebooks/HW1_Regression_with_inference.ipynb).

Также реализован базовый вариант сервиса, который позволяет по разным вариантам входных данных (json-описание одного объекта, список объектов или csv-файл с описаниями объектов) возвращать предсказание/я цены объекта (автомобиля). Код сервиса доступен в директории [`src`](./src).

Помимо этого в репозитории хранится [лучший вариант](./models/BEST_MODEL_PIPE.pkl) модели в виде `pickle` файла, который содержит в себе обученный пайплайн, внутри которого содержится вся логика предобработки сырых данных, а также модель (`Ridge` регрессия) с обученными весами (`coef_`, `intercept_`).

## Описание лучшей модели

Под описанием лучшей модели будем понимать не только модель, но и все манипуляции с данными, которые помогли добиться лучшего качества. Схема модели:

![изображение](https://github.com/slavkostrov/car_price_prediction_service/assets/64536258/fad71dc6-9373-41e4-a105-6e0b1a378e92)

* `FunctionTransformer` - включает в себя обработку входных колонок с единицами измерения, единицы измерения убираются или приводится к "общему знаменателю", сами колонки приводятся к типу `float`, помимо этого значение из колонки `torque` разбиваются на два столбца;
* `ColumnTransformer` - предобработка категориальных и числовых фичей + выбор только нужных колонок из датафрейма:
  * для числовых: заполнение пропусков медианой и нормировка;
  * для категориальных: `OneHotEncoding`.
* `PolynomialFeatures` - построение полиномиальных фичей 2 степени;
* `TransfomedTargetRegressor` включает в себя трансформацию таргета (логарифмирование на обучении и экспонента на предикте), а также саму модель линейной регрессии с L2 регуляризацией (`Ridge`).

Лучшие параметры для `Ridge` регресии подбирались с помощью поиска по сетке с k-fold кросс-валидацией на 10 фолдах.


## Метрики

По итогам на тестовой выборке лучшая модель показывает:
* R2 - 0.919.
* MSE - 46582351614.183.
* Доля предсказаний с отклонением от реальной цены не больше 10% - 0.354.

## Описание лучших экспериментов

По итогам всех экспериментов (подробнее в ноутбуке) наибольшего прироста в качестве удалось добиться с помощью:
* трансформации таргета, а если точнее - логарифмирования, которое позволило привести исходное распределение к чуть более похожему на нормальное;
* добавление полиномиальных фичей степени 2 - по построению графиков казалось, что в данных есть определенные нелинейные зависимости, поэтому добавление подобных фичей позволило ещё сильнее улучшить качество.

### Что можно пробовать ещё?

* можно попробовать другие модели, например основанные на деревьях, возможно дадут буст в том числе с учётом того, что есть кат. перменные;
* попридумывать новые фичи - различные варианты комбинации имеющихся фичей, а также использование внешних данных;
* предполагаю, что много полезного можно достать используя модель автомобиля, которая сейчас по сути не используется (в базовом варианте можно даже попробовать добавить категориальную фичу "марка автомобиля").

## Пример работы сервиса

[GDrive](https://drive.google.com/file/d/1vo2yzuj00wouYJRQZeX-jYj6ds3cckrX/view?usp=sharing)
